<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<script src="js/lib/rem.js" type="text/javascript" charset="utf-8"></script>
		<link rel="stylesheet" type="text/css" href="css/mui.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/index-tab-yg.css"/>
		<title>主界面-按医馆-copy</title>
	</head>
	<body>
		<li class="tab_ul_yg clearfix">
			<img src="img/yiguan.png"/>
			<div class="yg_text">
				<p>国医馆</p>
				<p class="addr_p"><i></i>地址</p>
			</div>
		</li>
		<div class="order_table_con">
			<div  class="mui-content mui-scroll-wrapper refresh-container">
				<div class="mui-scroll">
					<ul class="reg_card_ul">
						<div class="tic_card">
							<label class="tab_ul_ys clearfix">
								<img src="img/yisheng.png"/>
								<div class="ys_text">
									<p>李主任<span>男</span></p>
									<p>骨科</p>
								</div>
								<div class="ys_price">
									<p>专家号</p>
									<p>¥ 200</p>
								</div>
							</label>
							<p class="reg_tit clearfix">
								预约挂号
								<i></i>
								<span><b class="gray"></b>无号</span>
								<span><b class="blue"></b>有号</span>
							</p>
							<div class="reg_table">
								<div class="table_list">
									<dl class="date_line clearfix">
										<dt>排班表</dt>
										<dd><span></span><span>05-22</span></dd>
										<dd><span></span><span>05-22</span></dd>
										<dd><span></span><span>05-22</span></dd>
										<dd><span></span><span>05-22</span></dd>
										<dd><span></span><span>05-22</span></dd>
										<dd><span></span><span>05-22</span></dd>
										<dd><span></span><span>05-22</span></dd>
									</dl>
									<dl class="morning clearfix">
										<dt>上午</dt>
										<dd><i class="sell_out">已停</i></dd>
										<dd></dd>
										<dd><i class="sell_out">已满</i></dd>
										<dd></dd>
										<dd><a href="#"><span>剩余</span><span>9</span></a></dd>
										<dd></dd>
										<dd></dd>
									</dl>
									<dl class="afternoon clearfix">
										<dt>下午</dt>
										<dd><i class="sell_out">已停</i></dd>
										<dd></dd>
										<dd><i class="sell_out">已满</i></dd>
										<dd></dd>
										<dd></dd>
										<dd><a href="#"><span>剩余</span><span>9</span></a></dd>
										<dd></dd>
									</dl>
								</div>
							</div>
						</div>
						<div class="tic_card">
							<label class="tab_ul_ys clearfix">
								<img src="img/yisheng.png"/>
								<div class="ys_text">
									<p>李主任<span>男</span></p>
									<p>骨科</p>
								</div>
								<div class="ys_price">
									<p>专家号</p>
									<p>¥ 200</p>
								</div>
							</label>
							<p class="reg_tit clearfix">
								预约挂号
								<i></i>
								<span><b class="gray"></b>无号</span>
								<span><b class="blue"></b>有号</span>
							</p>
							<div class="reg_table">
								<div class="table_list">
									<dl class="date_line clearfix">
										<dt>排班表</dt>
										<dd><span>周一</span><span>05-22</span></dd>
										<dd><span>周一</span><span>05-22</span></dd>
										<dd><span>周一</span><span>05-22</span></dd>
										<dd><span>周一</span><span>05-22</span></dd>
										<dd><span>周一</span><span>05-22</span></dd>
										<dd><span>周一</span><span>05-22</span></dd>
										<dd><span>周一</span><span>05-22</span></dd>
									</dl>
									<dl class="morning clearfix">
										<dt>上午</dt>
										<dd><i class="sell_out">已停</i></dd>
										<dd></dd>
										<dd><i class="sell_out">已满</i></dd>
										<dd></dd>
										<dd><a href="#"><span>剩余</span><span>9</span></a></dd>
										<dd></dd>
										<dd></dd>
									</dl>
									<dl class="afternoon clearfix">
										<dt>下午</dt>
										<dd><i class="sell_out">已停</i></dd>
										<dd></dd>
										<dd><i class="sell_out">已满</i></dd>
										<dd></dd>
										<dd></dd>
										<dd><a href="#"><span>剩余</span><span>9</span></a></dd>
										<dd></dd>
									</dl>
								</div>
							</div>
						</div>
					</ul>
				</div>
			</div>
		</div>
		<script src="js/lib/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/lib/mui.pullToRefresh.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/lib/mui.pullToRefresh.material.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/lib/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/lib/mock.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			var nowPage = 1;
			var allPage;
			//日期格式化
			function funDate(aa){
		        var date1 = new Date(),
		        time1=date1.getFullYear()+"-"+(date1.getMonth()+1)+"-"+date1.getDate();
		        var date2 = new Date(date1);
		        date2.setDate(date1.getDate()+aa);
		        var time2 = date2.getFullYear()+"-"+(date2.getMonth()+1)+"-"+date2.getDate();
		        var myMonth = (date2.getMonth()+1);
		        var myDate = date2.getDate();
		      	var myWeek =  ['周日','周一','周二','周三','周四','周五','周六'][date2.getDay()];
		        if(myMonth<10){
		        	myMonth = "0"+myMonth;
		        }
		        if(myDate<10){
		        	myDate = "0"+myDate;
		        }
		        var endFormatTime = myMonth+"-"+myDate;
		        var funDate = {
		        	"orderDate":endFormatTime,
		        	"orderWeek":myWeek
		        };
		        return funDate;
		    }
			//设置日期
			function setTableDate(){
				$(".table_list").find(".date_line").each(function(index,ele){
					$(ele).find("dd").each(function(index,ele){
						$(ele).find("span").eq(0).html(funDate(index+1).orderWeek);
						$(ele).find("span").eq(1).html(funDate(index+1).orderDate);
					});
				});
			}
			function setTableClass(){
				$(".table_list").find(".date_line").each(function(index,ele){
					$(ele).find("dd").each(function(index,ele){
						$(ele).find("span").eq(0).html(funDate(index+1).orderWeek);
						$(ele).find("span").eq(1).html(funDate(index+1).orderDate);
					});
				});
			}
			//
			Mock.mock('mock.json', {    
			  'list|1-3': [{      
			         'name': '@cname',
			         'sex':'男',
			         'dep': "骨科",
			         'price|100-200':100,
			         'Url_picture':"img/addr.png",
			         "register_name":"专家号",
			         'momning':[0,-1,2,5,0,9,55],
			         'afternoon':[0,0,2,-1,0,9,23],
			     }],
			     'allPage':3,
			});
			function checkStr(num){
				var num = parseInt(num);
				var str = "";
				if(num===-1){
					str += '';
				}
				else if(num===0){
					str += '<i class="sell_out">已满</i>';
				}
				else if(num>0){
					str += '<a href="#"><span>剩余</span><span>'+num+'</span></a>';
				}
				return str;
			}
			function pullDown(){
		    	$.ajax({
			        url : 'mock.json',
			        type : "get",
			        //data: '{"pageNum": "nowPage", "age": 18}',
			        dataType : "json",
			        success : function(res) {
			        	var data = res.list;
			        	allPage = res.allPage;
			        	console.log(allPage);
						var fragment = document.createDocumentFragment();
						var str;
						//console.log(data);
						for (var i = 0; i < data.length; i++) {
							var amArr = data[i].momning;
							var pmArr = data[i].afternoon;
							var amStr1 = checkStr(data[i].momning[0]);
							var amStr2 = checkStr(data[i].momning[1]);
							var amStr3 = checkStr(data[i].momning[2]);
							var amStr4 = checkStr(data[i].momning[3]);
							var amStr5 = checkStr(data[i].momning[4]);
							var amStr6 = checkStr(data[i].momning[5]);
							var amStr7 = checkStr(data[i].momning[6]);
							
							var pmStr1 = checkStr(data[i].afternoon[0]);
							var pmStr2 = checkStr(data[i].afternoon[1]);
							var pmStr3 = checkStr(data[i].afternoon[2]);
							var pmStr4 = checkStr(data[i].afternoon[3]);
							var pmStr5 = checkStr(data[i].afternoon[4]);
							var pmStr6 = checkStr(data[i].afternoon[5]);
							var pmStr7 = checkStr(data[i].afternoon[6]);
							
							str = document.createElement('div');
							str.className = "tic_card"
							str.innerHTML =	'<label class="tab_ul_ys clearfix">'+
								'<img src='+data[i].Url_picture+'/>'+
								'<div class="ys_text">'+
									'<p>'+data[i].name+'<span>'+data[i].sex+'</span></p>'+
									'<p>'+data[i].dep+'</p>'+
								'</div>'+
								'<div class="ys_price">'+
									'<p>'+data[i].register_name+'</p>'+
									'<p>¥ '+data[i].price+'</p>'+
								'</div>'+
							'</label>'+
							'<p class="reg_tit clearfix">'+
								'预约挂号'+
								'<i></i>'+
								'<span><b class="gray"></b>无号</span>'+
								'<span><b class="blue"></b>有号</span>'+
							'</p>'+
							'<div class="reg_table">'+
								'<div class="table_list">'+
									'<dl class="date_line clearfix">'+
										'<dt>排班表</dt>'+
										'<dd><span></span><span></span></dd>'+
										'<dd><span></span><span></span></dd>'+
										'<dd><span></span><span></span></dd>'+
										'<dd><span></span><span></span></dd>'+
										'<dd><span></span><span></span></dd>'+
										'<dd><span></span><span></span></dd>'+
										'<dd><span></span><span></span></dd>'+
									'</dl>'+
									'<dl class="morning clearfix">'+
										'<dt>上午</dt>'+
										'<dd>'+amStr1+'</dd>'+
										'<dd>'+amStr2+'</dd>'+
										'<dd>'+amStr3+'</dd>'+
										'<dd>'+amStr4+'</dd>'+
										'<dd>'+amStr5+'</dd>'+
										'<dd>'+amStr6+'</dd>'+
										'<dd>'+amStr7+'</dd>'+
									'</dl>'+
									'<dl class="afternoon clearfix">'+
										'<dt>下午</dt>'+
										'<dd>'+pmStr1+'</dd>'+
										'<dd>'+pmStr2+'</dd>'+
										'<dd>'+pmStr3+'</dd>'+
										'<dd>'+pmStr4+'</dd>'+
										'<dd>'+pmStr5+'</dd>'+
										'<dd>'+pmStr6+'</dd>'+
										'<dd>'+pmStr7+'</dd>'+
									'</dl>'+
								'</div>'+
							'</div>';
							fragment.appendChild(str);
						}
						var ul = document.querySelector('.reg_card_ul');
						ul.appendChild(fragment);
						setTableDate();
			        }
				});
			}
			//加载执行
			$(function(){
				var winHeight = window.innerHeight;
				$(".order_table_con").height(winHeight-5-$('.tab_ul_yg').outerHeight());
				setTableDate();
			});
			//改变分辨率执行
			window.addEventListener('resize', function(event){
				var winHeight = window.innerHeight;
				$(".order_table_con").height(winHeight-5-$('.tab_ul_yg').outerHeight());
			});
			(function($) {
				$('.mui-scroll-wrapper').scroll({
					indicators: false //是否显示滚动条
				});
				var deceleration = mui.os.ios?0.003:0.0009;
				$('.mui-scroll-wrapper').scroll({
					bounce: false,
					indicators: true, //是否显示滚动条
					deceleration:deceleration
				});
				function setTableDate(){
					jQuery(".table_list").find(".date_line").each(function(index,ele){
						jQuery(ele).find("dd").each(function(index,ele){
							jQuery(ele).find("span").eq(0).html(funDate(index+1).orderWeek);
							jQuery(ele).find("span").eq(1).html(funDate(index+1).orderDate);
						});
					});
				}
				$.ready(function() {
					$.each(document.querySelectorAll('.refresh-container .mui-scroll'), function(index, pullRefreshEl) {
						$(pullRefreshEl).pullToRefresh({
							up: {
								callback: function() {
									var self = this;
									setTimeout(function() {
										nowPage++;
										console.log(nowPage);
										pullDown();
										if(nowPage==allPage){
											self.endPullUpToRefresh(true);
										}else{
											self.endPullUpToRefresh();
										}
									}, 1000);
								}
							}
						});
					});
				});
			})(mui);
		</script>
	</body>
</html>
